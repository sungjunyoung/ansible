- name: Change hostname
  ansible.builtin.hostname:
    name: "{{ inventory_hostname }}"
    use: systemd

- name: Install requirements
  yum:
    name:
      - gcc
      - pcre-devel
      - tar
      - make
    state: present

- name: Download file from a file path
  ansible.builtin.get_url:
    url: "http://www.haproxy.org/download/{{ haproxy_version }}/src/haproxy-{{ haproxy_version }}.{{ haproxy_patch_version }}.tar.gz"
    dest: /root

- name: Extract haproxy.tar.gz into /root/haproxy
  ansible.builtin.unarchive:
    src: "/root/haproxy-{{ haproxy_version }}.{{ haproxy_patch_version }}.tar.gz"
    dest: "/root"
    remote_src: yes

- name: Install haproxy
  ansible.builtin.command: "bash -lc 'cd /root/haproxy-{{ haproxy_version }}.{{ haproxy_patch_version }} && make TARGET=linux-glibc && make install'"

- name: Creates haproxy config directory
  file:
    path: "/etc/haproxy"
    state: directory

- name: Copying configuration file
  template:
    src: haproxy.cfg.j2
    dest: /etc/haproxy/haproxy.cfg
    owner: root
    mode: 0755